<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../css/main_theme.css" />

        <link rel="stylesheet" href="../ico/uicons-regular-rounded/css/uicons-regular-rounded.css" />
        <link rel="stylesheet" href="../ico/uicons-solid-rounded/css/uicons-solid-rounded.css" />
        <link rel="stylesheet" href="../css/style_navigation_bar.css"/>

        <link rel="stylesheet" href="../css/stylesheet_frags.css" />
        <link rel="stylesheet" href="../css/style_button.css"/>

        <link rel="stylesheet" href="../css/popup.css" />
        <link rel="stylesheet" href="../css/modal.css" />
        
        <!--moving.css-->
        <style>

            #moving-screen {
                position: fixed;
                top: 0;
                left: 101vw;
                width: 100vw;
                height: 100vh;
                background-color: var(--background-color);
                
                transition: var(--touch-transistion) ease-in-out;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
                display: none;
                z-index: 2;
            }

            #moving-screen.active {
                left: 0;
            }

            #screen_header {
                padding-top: 25px;
                padding-bottom: 10px;
                margin-bottom: 5px;
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }

            #screen_header a {
                text-decoration: none;
                color: var(--primary-color);
                font-size: 2em;
                margin-left: 15px;
                width: 32px;
                height: 32px;
            }

            #screen_header i {
                position: absolute;
                display: flex;
                align-items: center;

                transition: var(--touch-transistion);
                border-radius: 50%;
            }

            #screen_header i:active {
                background-color: rgba(0, 0, 0, 0.2);
            }

        </style>

        <!--setting.css-->
        <style>
            #page-content i {
                position: absolute;
                display: flex;
                align-items: center;
            }

            #user_info {
                margin: 20px;
                display: grid;
                grid-template-columns: 50% auto;
                align-items: center;
            }

            #user_name {
                font-size: 1.2em;
                font-weight: 600;
                text-align: end;
                padding: 0 10px;
            }

            .circle {
                width: fit-content;
                height: fit-content;
                border-radius: 50%;
                background: var(--primary-color);
                box-shadow: var(--border-shadow);
            }

            .circle i {
                position: relative !important;
                padding: 10px;
                color: white;
                font-size: 4em;
                text-shadow: var(--border-shadow);
            }


            /* Menu */
            #menu_setting {
                display: flex;
                flex-direction: column;
                margin: 0 20px;
            }

            .settings_button {
                padding: 15px;
                text-decoration: none;
                transition: var(--touch-transistion);
                border-radius: 50px;
                
                color: #444444;
                -webkit-tap-highlight-color: transparent;
            }

            .settings_button:active {
                color: white;
                background-color: var(--primary-color);
            }

            .settings_button span {
                margin-left: 2em;
            }

            .settings_button i {
                color: var(--primary-color);
            }
            
            #caution_container {
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 20px;
            }

            .caution_button {
                width: 200px;
                background-color: var(--primary-color);
                box-shadow: var(--border-shadow);
                color: white;
                font-weight: 600;
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <section id="page-content">
            <h1>Settings</h1>

            <div id="user_info">
                <div id="user_name">
                    Full name
                </div>
                <div id="user_picture" class="circle">
                    <i class="fi fi-rr-user"></i>
                </div>
            </div>

            <div id="menu_setting">
                <a id="set_but_pp" href="#" class="settings_button">
                    <i id="ico_pp" class="fi fi-rr-user"></i>
                    <span class="button__text">Change your profile picture</span>
                </a>
                <a id="set_but_sl" href="#" class="settings_button">
                    <i id="ico_sl" class="fi fi-rr-flag"></i> <!--fi-rr-globe-->
                    <span class="button__text">Select language</span>
                </a>
                <a id="set_but_pi" href="#" class="settings_button">
                    <i id="ico_pi" class="fi fi-rr-info"></i>
                    <span class="button__text">Personal informations</span>
                </a>
                <a id="set_but_jh" href="#" class="settings_button">
                    <i id="ico_jh" class="fi fi-rr-time-past"></i>
                    <span class="button__text">Journey history</span>
                </a>
                <a id="set_but_bc" href="#" class="settings_button">
                    <i id="ico_bc" class="fi fi-rr-credit-card"></i>
                    <span class="button__text">My bank details</span>
                </a>
            </div>

            <div id="caution_container">
                <button id="delete_account_button" class="caution_button">Delete my account</button>
                <button id="log_out_button" class="caution_button">Log out</button>
            </div>

        </section>

        <section id="moving-screen">
            <div id="screen_header">
                <a id="sec_but_re" href="#">
                    <i id="ico_return" class="fi fi-rr-arrow-small-left"></i>
                </a>
                <h1 id="title">[Title]</h1>
            </div>
            
            <!--Page name-->
            <section id="set_sec_pp" class="section_moving" hidden>
                Content profile picture
            </section>

            <section id="set_sec_sl" class="section_moving" hidden>
                Content language
            </section>
    
            <section id="set_sec_pi" class="section_moving" hidden>
                Content Personal informations
            </section>
    
            <section id="set_sec_jh" class="section_moving" hidden>
                Content journey history
            </section>
            
            <section id="set_sec_bc" class="section_moving" hidden>
                Content bank details
            </section>
            
        </section>
       
        <!-- Popups message -->
        <div id="modal_popup" class="modal">
            <!-- Popup message for book a vehicle -->
            <div id="popup" class="popup">
                <h1>Delete your account?</h1>
                <div id="popup_information">
                    <i id="ico_warning" class="fi fi-rr-exclamation"></i>
                    <span>Whole your informations will be deleted.</span>
                </div>
                <div id="popup_buttons">
                    <button id="but_pop_goback">No, go back</button>
                    <button id="but_pop_delete" class="border-button">Yes, delete</button>
                </div>
            </div>
        </div>

        <nav id="navigation" class="nav">
            <a id="nav_home" href="#" class="nav__link nav__link__ripple">
                <i id="ico_home" class="nav__icon fi fi-rr-home"></i>
                <span class="nav__text">Home</span>
            </a>
            <a id="nav_drive" href="#" class="nav__link nav__link__ripple">
                <i id="ico_drive" class="nav__icon fi fi-rr-search"></i>
                <span class="nav__text">Drive</span>
            </a>
            <a id="nav_vehicles" href="#" class="nav__link nav__link__ripple">
                <i id="ico_vehicles" class="nav__icon fi fi-rr-car"></i>
                <span class="nav__text">Vehicles</span>
            </a>
            <a id="nav_settings" href="#" class="nav__link nav__link__ripple nav__link--active">
                <i id="ico_settings" class="nav__icon fi fi-sr-settings"></i>
                <span class="nav__text">Settings</span>
            </a>
        </nav>

        <script src="../js/androidInterface.js"></script>
        <script src="../js/nav.js"></script>

        <script src="../js/popup.js"></script>
        <script src="../js/popup_delete.js"></script>

        <!--moving.js-->
        <script>
            
            const setting_page_pp = document.getElementById("moving-screen");

            setting_page_pp.addEventListener('touchstart', touchStart);
            setting_page_pp.addEventListener('touchmove', touchMove);
            setting_page_pp.addEventListener('touchend', touchEnd);

            var startingX, count;

            function touchStart(event) {
                startingX = event.touches[0].clientX;
                //console.log("start " + startingX);
                count = 0;
                setting_page_pp.style.transition = '0s';
            }

            function touchMove(event) {
                let change = event.touches[0].clientX - startingX;
                count++;
                // If move to right to left
                if(change < 0)
                    return;
                
                if(change > 50)
                    setting_page_pp.style.left = change - 50 + 'px';
                event.preventDefault();
            }

            function touchEnd(event) {
                let endedX = event.changedTouches[0].clientX;
                let change = endedX - startingX;

                setting_page_pp.style.transition = '0.3s ease-in-out';
                if(determinateChange(startingX, endedX, change, count)){
                    //console.log("rest");
                    setting_page_pp.style.left = '0px';
                } else {
                    //console.log("leave");
                    setting_page_pp.style.left = '101vw';
                }
            }

            function determinateChange(start, end, change, sample) {
                let speed =  change / sample;
                console.log("-> start=" + start + "px, end=" + end + "px, diff=" + change + "px, nbr=" + sample + ", speed=" + speed);
                
                if(speed > 10){
                    console.log("speed")
                    return false;
                }

                let threshold = screen.width / 2;
                if(change < threshold){
                    console.log("threshold");
                    return true;
                }
                    
                return false;
            }
            
        </script>

        <!--settings.js-->
        <script>
            // On load page:
            if(androidConnected()) Android.requestUserName();

            // Callback
            function setUserName(name){
                let nameElmt = document.getElementById("user_name");
                nameElmt.textContent = name;
            }

            //

            const PROFILE_PICTURE_SCREEN = 0,
                SELECT_LANGUAGE_SCREEN = 1,
                PERSONAL_INFO_SCREEN = 2,
                JOURNEY_HISTORY_SCREEN = 3,
                BANK_DETAIL_SCREEN = 4;
            
            const buttons = document.querySelectorAll(".settings_button");
            const sections = document.querySelectorAll(".section_moving");

            buttons.forEach((btn, index) => {
                btn.addEventListener("click", function () {
                    setting_page_pp.style.display = 'block';
                    setTimeout(function () {
                        setting_page_pp.style.left = '0px';
			        }, 10);
                    
                    // Set content
                    sections.forEach((sec) => sec.hidden = true);
                    sections[index].hidden = false;

                    // Set title
                    let title = document.getElementById("title");
                    switch (index) {
                        case PROFILE_PICTURE_SCREEN:
                            title.textContent = "Profile Picture";
                            break;
                        case SELECT_LANGUAGE_SCREEN:
                            title.textContent = "Languages";
                            break;
                        case PERSONAL_INFO_SCREEN:
                            title.textContent = "Personal Informations";
                            break;
                        case JOURNEY_HISTORY_SCREEN:
                            title.textContent = "History";
                            break;
                        case BANK_DETAIL_SCREEN:
                            title.textContent = "Bank details";
                            break;
                    
                        default:
                            break;
                    }

                });
            });
                        
            const button_return = document.getElementById("sec_but_re");
            button_return.addEventListener("click", function () {
                setting_page_pp.style.left = '101vw';
            });



            // delete account:
            // Open popup "Are you sure ?"
            const delete_account_button = document.getElementById("delete_account_button");
            delete_account_button.addEventListener('click', function () {
                console.log("delete");
                openPopup(popup);
            });

            // Log out
            const logOutButton = document.getElementById("log_out_button");
            logOutButton.addEventListener('click', function () {
                console.log("logout");
                if(androidConnected()) Android.logout();
            });

        </script>
    </body>
</html>
